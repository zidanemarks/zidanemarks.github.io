---
layout:     post
title:      非实时优先权线程调度器-源码分析
subtitle:   嵌入式开发 内核进阶
date:       2020-01-21
author:     Shawn.Tan
header-img: img/post-bg-scheduler3-web.jpg
catalog: true
tags:
    - 嵌入式
    - SSD
    - CPU架构
    - 操作系统
    - RISC-V
---
# 前言
**调度器（scheduler**是计算机操作系统内核对进程或线程分配CPU计算资源的基本模块。
![调度器功能](img/post-sheduler-structure-web1.jpg)

在桌面机，嵌入式设备或大型机等不同的应用环境中，产生了不同资源分配策略的调度器，针对不同层面，分为以下集中调度器

**1. 高级调度器（long-term scheduler）：** 通常用于面向批处理的多程序环境中，通过均衡内存中的任务以欧化系统资源，包括CPU，内存和硬盘存储等。
**2. 中级调度器（medium-term scheduler）：** 跟踪CPU上执行的进程的动态内存用量来决定是否要增加或减少“多通道程度“（内存中竞争CPU的进程个数），以防止”颠簸“。颠簸即当前的进程集合的内存需求超过了系统容量，导致进程在各自的执行中变得缓慢。
**3. 低级调度器（short-term scheduler）：** 负责在当前驻留的内存里的进程中选择一个来运行。这篇内容设计的算法主要关注的都是低级调度器

**本文将主要分析一种应用在Xilinx公司Microblaze嵌入式CPU平台中的低级调度器**，计划按以下四篇主题来介绍这款调度器的具体实现和应用改进实验

1. 调度器源码分析
2. 基于VEGA织女星NXP-RVM1-Series RI5CY平台的调度器移植实验
3. 基于中断时间片的调度器改进实验
4. 调度器性能分析

**本篇文章为主题的第一部分，主要分析调度器的源码实现。** 在低级调度器中，一般划分为：非抢占式和抢占式。非抢占式的调度器中，一个进程要不然就一直执行到底，要不然就自己主动资源放弃处理器，以处理I/O请求，调度器只是安排先后顺序；而抢占式调度器里，调度器从当前进程手中把处理器抢走，交给另一个进程，有这么一个主动的动作。不管是哪一种，调度器的执行步骤一般如下：

1. 获得处理器的控制权
2. 把当前正在运行的进程状态（PCB，process control block）保存下来
3. 选择一个新的进程来执行
4. 把新选择出来的进程分发给处理器运行，这一步会把第二步中的状态再加载到CPU寄存器中。
可以看出，在调度器调度过程中，进程状态很重要，它包括了很多信息：程序执行到哪儿了（PC指针）以便回来继续执行，程序在内存中的足迹等等。以下内容将就上述四个步骤分析调度器的实现结构


# 源码分析

## 结构分析







